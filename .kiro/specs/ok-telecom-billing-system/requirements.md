# Документ требований - Биллинг-система "OK-Telecom"

## Введение

Биллинг-система "OK-Telecom" представляет собой комплексное решение для автоматизации процессов оказания услуг интернет-провайдера, включающее управление клиентами, тарификацию, биллинг и интеграцию с сетевым оборудованием MikroTik. Система состоит из административной панели для сотрудников, личного кабинета для абонентов и Telegram-бота.

## Требования

### Требование 1 - Система безопасности и аутентификации

**Пользовательская история:** Как администратор системы, я хочу иметь безопасную систему аутентификации с ролевой моделью доступа, чтобы обеспечить контролируемый доступ к функциям системы.

#### Критерии приемки

1. КОГДА система запускается впервые И в базе данных отсутствуют администраторы, ТО система ДОЛЖНА перенаправить на страницу создания учетной записи главного администратора
2. КОГДА в системе существует хотя бы один администратор, ТО доступ к системе ДОЛЖЕН осуществляться через форму авторизации с логином и паролем
3. КОГДА администратор входит в систему, ТО система ДОЛЖНА поддерживать роли с разными уровнями доступа (Суперадмин, Кассир, Монтажник)
4. КОГДА суперадмин управляет ролями, ТО система ДОЛЖНА позволять создавать, редактировать роли и назначать их пользователям
5. КОГДА суперадмин управляет администраторами, ТО система ДОЛЖНА позволять добавлять, редактировать и деактивировать учетные записи администраторов

### Требование 2 - Панель управления и аналитика

**Пользовательская история:** Как администратор, я хочу видеть сводную информацию о состоянии системы на главной странице, чтобы быстро оценивать ключевые показатели бизнеса.

#### Критерии приемки

1. КОГДА администратор авторизуется в системе, ТО главная страница ДОЛЖНА отображать количество активных абонентов
2. КОГДА администратор просматривает дашборд, ТО система ДОЛЖНА показывать количество заблокированных абонентов
3. КОГДА администратор анализирует финансы, ТО система ДОЛЖНА отображать поступления за сегодня и за текущий месяц
4. КОГДА администратор просматривает активность, ТО система ДОЛЖНА показывать список последних платежей и заявок
5. КОГДА администратор анализирует тренды, ТО система ДОЛЖНА отображать графики ключевых метрик

### Требование 3 - Управление сетевым оборудованием MikroTik

**Пользовательская история:** Как сетевой администратор, я хочу управлять устройствами MikroTik через веб-интерфейс, чтобы централизованно контролировать сетевую инфраструктуру.

#### Критерии приемки

1. КОГДА администратор переходит на страницу /devices, ТО система ДОЛЖНА отображать таблицу добавленных устройств с IP, описанием и статусом подключения
2. КОГДА администратор добавляет новое устройство И вводит IP-адрес, ТО система ДОЛЖНА проверить доступность устройства через ping
3. КОГДА администратор вводит логин и пароль устройства, ТО система ДОЛЖНА проверить подключение к API MikroTik
4. КОГДА администратор завершает добавление устройства, ТО система ДОЛЖНА сохранить устройство в базе данных с описанием
5. КОГДА происходят операции с абонентами, ТО система ДОЛЖНА отправлять сообщения в Kafka для обработки на соответствующем MikroTik

### Требование 4 - Управление тарифами и услугами

**Пользовательская история:** Как менеджер по продуктам, я хочу гибко управлять тарифными планами и услугами, чтобы адаптировать предложения под потребности разных групп клиентов.

#### Критерии приемки

1. КОГДА менеджер создает услугу, ТО система ДОЛЖНА поддерживать базовые единицы (Интернет, IPTV, Cloud Storage)
2. КОГДА менеджер создает тарифный план, ТО система ДОЛЖНА позволять указать название, стоимость, скорость, способ списания и список услуг
3. КОГДА менеджер группирует тарифы, ТО система ДОЛЖНА поддерживать группы тарифов для отображения определенным группам абонентов
4. КОГДА менеджер настраивает биллинг, ТО система ДОЛЖНА поддерживать предоплату за период и почасовую тарификацию
5. КОГДА настраивается тариф, ТО система ДОЛЖНА позволять установить параметр уведомления о скором окончании средств

### Требование 5 - Управление абонентами

**Пользовательская история:** Как оператор, я хочу эффективно управлять данными абонентов и их лицевыми счетами, чтобы обеспечить качественное обслуживание клиентов.

#### Критерии приемки

1. КОГДА оператор работает с клиентами, ТО система ДОЛЖНА разделять сущности "Абонент" (ФИО, контакты) и "Лицевой счет" (баланс, тариф)
2. КОГДА оператор просматривает список абонентов, ТО система ДОЛЖНА отображать таблицу с Л/С, ФИО, адресом, телефоном, тарифом, балансом и статусом
3. КОГДА оператор открывает карточку абонента, ТО система ДОЛЖНА показывать полную информацию включая карту с координатами и историю действий
4. КОГДА оператор создает абонента, ТО система ДОЛЖНА позволить ввести ФИО, телефоны, email, Telegram и создать лицевой счет
5. КОГДА оператор настраивает подключение, ТО система ДОЛЖНА позволить указать MAC-адрес, pool-name и порог баланса для блокировки

### Требование 6 - Система заявок

**Пользовательская история:** Как менеджер по работе с клиентами, я хочу эффективно обрабатывать заявки от потенциальных абонентов, чтобы обеспечить быстрое подключение новых клиентов.

#### Критерии приемки

1. КОГДА потенциальный клиент подает заявку через app-web, ТО система ДОЛЖНА сохранить данные (адрес, ФИО, телефон, желаемые услуги) в базе данных
2. КОГДА заявка создается, ТО система ДОЛЖНА автоматически создать учетную запись абонента без лицевого счета
3. КОГДА менеджер работает с заявками, ТО система ДОЛЖНА предоставить CRM-панель для просмотра и фильтрации заявок
4. КОГДА менеджер обрабатывает заявку, ТО система ДОЛЖНА позволить изменять статусы (Новая, В работе, Выполнена, Отменена)
5. КОГДА монтажник выполняет заявку, ТО система ДОЛЖНА позволить привязать лицевой счет к существующей учетной записи абонента

### Требование 7 - Касса и платежная система

**Пользовательская история:** Как кассир, я хочу быстро обрабатывать платежи и пополнения счетов, чтобы обеспечить бесперебойное предоставление услуг абонентам.

#### Критерии приемки

1. КОГДА кассир пополняет баланс, ТО система ДОЛЖНА позволить поиск по номеру телефона, адресу или лицевому счету
2. КОГДА кассир вносит платеж, ТО система ДОЛЖНА позволить указать сумму и комментарий (видимый только админу)
3. КОГДА абонент оплачивает онлайн, ТО система ДОЛЖНА предоставить публичную страницу /payment с интеграцией Robokassa
4. КОГДА приходит webhook от Robokassa, ТО система ДОЛЖНА автоматически зачислить средства на лицевой счет
5. КОГДА происходят транзакции, ТО система ДОЛЖНА вести полную историю всех платежей с указанием источника

### Требование 8 - Система уведомлений

**Пользовательская история:** Как администратор, я хочу настроить автоматические уведомления для абонентов, чтобы информировать их о важных событиях по их счетам.

#### Критерии приемки

1. КОГДА система отправляет уведомление, ТО она ДОЛЖНА использовать приоритет: 1. Telegram, 2. SMS (если Telegram недоступен)
2. КОГДА настраивается SMS-шлюз, ТО система ДОЛЖНА поддерживать подключение к модему Huawei E3372
3. КОГДА отправляется Telegram-уведомление, ТО система ДОЛЖНА использовать Telegram Bot API
4. КОГДА администратор настраивает уведомления, ТО система ДОЛЖНА позволить редактировать шаблоны всех системных сообщений
5. КОГДА отправляются уведомления, ТО система ДОЛЖНА вести журнал с датой, каналом, получателем и статусом

### Требование 9 - Личный кабинет и Telegram-бот

**Пользовательская история:** Как абонент, я хочу удобно просматривать информацию о своих услугах и совершать платежи через веб-интерфейс и Telegram-бота.

#### Критерии приемки

1. КОГДА абонент входит в личный кабинет, ТО система ДОЛЖНА обеспечить авторизацию по номеру телефона
2. КОГДА абонент просматривает информацию, ТО система ДОЛЖНА показывать баланс, тариф, остаток дней и подключенные услуги по всем лицевым счетам
3. КОГДА абонент проверяет историю, ТО система ДОЛЖНА отображать историю платежей
4. КОГДА абонент использует Telegram-бота, ТО система ДОЛЖНА обеспечить авторизацию через кнопку "Отправить номер телефона"
5. КОГДА у абонента несколько лицевых счетов, ТО Telegram-бот ДОЛЖЕН позволить выбрать нужный для просмотра информации
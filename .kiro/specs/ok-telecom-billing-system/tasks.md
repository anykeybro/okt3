# План реализации - Биллинг-система "OK-Telecom"

- [x] 1. Настройка базовой инфраструктуры и моделей данных





  - Обновить схему Prisma с полными моделями данных для всех сущностей системы
  - Создать миграции для инициализации базы данных
  - Настроить базовую структуру модулей в app-server
  - _Требования: 1.1, 1.2, 1.3, 1.4, 5.1_

- [x] 2. Реализация системы аутентификации и авторизации





  - Создать модуль auth с JWT токенами и middleware для проверки прав
  - Реализовать RBAC систему с ролями и правами доступа
  - Добавить эндпоинты для управления администраторами и ролями
  - Создать middleware для первоначальной настройки системы
  - Написать unit тесты для модуля аутентификации
  - _Требования: 1.1, 1.2, 1.3, 1.4_

- [x] 3. Создание модуля управления услугами и тарифами












  - Реализовать CRUD операции для услуг (Service)
  - Создать API для управления тарифными планами (Tariff)
  - Добавить функциональность групп тарифов (TariffGroup)
  - Реализовать валидацию бизнес-правил для тарифов
  - Написать unit тесты для модуля тарифов
  - _Требования: 4.1, 4.2, 4.3_

- [ ] 4. Разработка модуля управления абонентами
  - Создать API для управления абонентами (Client)
  - Реализовать функциональность лицевых счетов (Account)
  - Добавить интеграцию с Yandex Maps для геолокации
  - Создать эндпоинты для поиска и фильтрации абонентов
  - Реализовать валидацию данных абонентов
  - Написать unit тесты для модуля абонентов
  - _Требования: 5.1, 5.2, 5.3, 5.4_

- [ ] 5. Реализация системы управления сетевым оборудованием
  - Создать модуль для управления устройствами MikroTik
  - Реализовать API для добавления и проверки устройств
  - Добавить функции ping и проверки авторизации устройств
  - Создать Kafka producer для отправки команд на устройства
  - Написать unit тесты для модуля устройств
  - _Требования: 3.1, 3.2, 3.3_

- [ ] 6. Создание системы заявок (CRM)
  - Реализовать модуль для обработки заявок от клиентов
  - Создать API для управления статусами заявок
  - Добавить автоматическое создание абонентов при подаче заявки
  - Реализовать фильтрацию и поиск заявок
  - Написать unit тесты для модуля заявок
  - _Требования: 6.1, 6.2, 6.3_

- [ ] 7. Разработка платежной системы
  - Создать модуль для обработки платежей
  - Реализовать интеграцию с Robokassa API
  - Добавить обработку webhook'ов от Robokassa
  - Создать API для ручного пополнения баланса
  - Реализовать историю транзакций
  - Написать unit тесты для платежного модуля
  - _Требования: 7.1, 7.2, 7.3_

- [ ] 8. Создание биллингового движка
  - Реализовать движок для автоматического списания средств
  - Добавить поддержку предоплатной и почасовой тарификации
  - Создать cron задачи для периодического списания
  - Реализовать логику автоматической блокировки при недостатке средств
  - Написать unit тесты для биллингового движка
  - _Требования: 4.4, 5.4_

- [ ] 9. Разработка системы уведомлений
  - Создать модуль для отправки SMS через Huawei E3372
  - Реализовать интеграцию с Telegram Bot API
  - Добавить систему шаблонов уведомлений
  - Создать приоритетную отправку (Telegram -> SMS)
  - Реализовать журнал отправки уведомлений
  - Написать unit тесты для модуля уведомлений
  - _Требования: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 10. Создание панели управления (Dashboard)
  - Реализовать API для получения аналитических данных
  - Создать эндпоинты для метрик (активные абоненты, платежи, заявки)
  - Добавить генерацию графиков и статистики
  - Реализовать кеширование для производительности
  - Написать unit тесты для dashboard API
  - _Требования: 2.1_

- [ ] 11. Разработка административного веб-интерфейса (app-web-billing)
  - Создать базовую структуру Next.js приложения с TypeScript
  - Реализовать систему аутентификации для администраторов
  - Создать компоненты для управления абонентами
  - Добавить интерфейс управления тарифами и услугами
  - Реализовать CRM панель для заявок
  - Создать интерфейс кассы для платежей
  - Добавить страницы управления устройствами
  - Создать настройки уведомлений и шаблонов
  - _Требования: 1.2, 2.1, 3.1, 4.2, 5.2, 6.3, 7.1, 8.4_

- [ ] 12. Создание публичного сайта и личного кабинета (app-web)
  - Настроить базовую структуру Next.js приложения
  - Создать главную страницу провайдера
  - Реализовать форму подачи заявок
  - Добавить систему авторизации по номеру телефона для ЛК
  - Создать интерфейс личного кабинета абонента
  - Реализовать страницу оплаты с интеграцией Robokassa
  - Добавить отображение истории платежей
  - _Требования: 6.1, 7.2, 9.1_

- [ ] 13. Разработка Telegram бота
  - Создать модуль для обработки Telegram webhook'ов
  - Реализовать авторизацию через номер телефона
  - Добавить команды для просмотра баланса и тарифа
  - Создать интерфейс выбора лицевого счета
  - Реализовать отображение истории платежей
  - Добавить уведомления через бота
  - Написать unit тесты для Telegram модуля
  - _Требования: 9.2_

- [ ] 14. Настройка Kafka интеграции для MikroTik
  - Создать Kafka consumer для обработки команд устройств
  - Реализовать отправку команд DHCP на MikroTik устройства
  - Добавить обработку блокировки/разблокировки абонентов
  - Создать мониторинг статуса выполнения команд
  - Написать integration тесты для Kafka интеграции
  - _Требования: 3.3_

- [ ] 15. Реализация системы мониторинга и логирования
  - Настроить Winston для структурированного логирования
  - Добавить метрики для Zabbix мониторинга
  - Создать health check эндпоинты для всех сервисов
  - Реализовать централизованную обработку ошибок
  - Добавить rate limiting для API эндпоинтов
  - _Требования: Нефункциональные требования_

- [ ] 16. Создание системы конфигурации
  - Создать config.ts файлы для каждого пакета
  - Вынести все настраиваемые параметры в конфигурацию
  - Добавить валидацию переменных окружения
  - Создать документацию по конфигурации
  - _Требования: Архитектурные принципы_

- [ ] 17. Написание интеграционных тестов
  - Создать тесты для полного цикла работы с абонентами
  - Добавить тесты интеграции с внешними API (Robokassa, Telegram)
  - Реализовать тесты для биллингового цикла
  - Создать тесты для системы уведомлений
  - Добавить тесты для Kafka интеграции
  - _Требования: Все модули_

- [ ] 18. Оптимизация производительности и безопасности
  - Добавить индексы в MongoDB для оптимизации запросов
  - Реализовать кеширование часто запрашиваемых данных
  - Добавить валидацию и санитизацию всех входных данных
  - Настроить HTTPS и безопасные заголовки
  - Реализовать аудит действий администраторов
  - _Требования: Нефункциональные требования_

- [ ] 19. Создание документации и деплой скриптов
  - Написать API документацию с использованием Swagger/OpenAPI
  - Создать руководство по развертыванию системы
  - Добавить документацию по конфигурации и настройке
  - Создать скрипты для автоматического деплоя
  - Написать руководство пользователя для административной панели
  - _Требования: Документация_

- [ ] 20. Финальное тестирование и интеграция
  - Провести end-to-end тестирование всех пользовательских сценариев
  - Выполнить нагрузочное тестирование системы
  - Протестировать все интеграции с внешними системами
  - Провести тестирование безопасности
  - Создать план резервного копирования и восстановления
  - _Требования: Все требования системы_
# Публичный сайт и личный кабинет (app-web)

## Обзор

Публичный сайт и личный кабинет абонентов реализован на базе Next.js 15 с использованием TypeScript и Material-UI. Приложение предоставляет интерфейс для потенциальных и существующих клиентов провайдера.

## Структура проекта

```
packages/app-web/
├── src/
│   ├── app/                    # App Router страницы
│   │   ├── auth/              # Страница авторизации
│   │   ├── cabinet/           # Личный кабинет
│   │   │   └── components/    # Компоненты кабинета
│   │   ├── payment/           # Система оплаты
│   │   │   └── result/        # Результат оплаты
│   │   ├── request/           # Подача заявок
│   │   ├── layout.tsx         # Корневой layout
│   │   ├── page.tsx           # Главная страница
│   │   └── providers.tsx      # Провайдеры контекста
│   └── shared/                # Общие компоненты
│       ├── api/               # API клиент
│       ├── components/        # Переиспользуемые компоненты
│       ├── config/            # Конфигурация
│       ├── hooks/             # React хуки
│       ├── providers/         # Провайдеры контекста
│       ├── types/             # TypeScript типы
│       └── ui/                # UI компоненты
├── package.json
├── next.config.js
└── tsconfig.json
```

## Реализованный функционал

### 1. Главная страница провайдера

**Файл:** `src/app/page.tsx`

**Функции:**
- Презентация услуг провайдера
- Информация о тарифах и преимуществах
- Навигация к подаче заявок и личному кабинету
- Контактная информация
- Адаптивный дизайн

**Секции:**
- Шапка с навигацией
- Главный баннер с призывом к действию
- Блок услуг (Интернет, IPTV, Облачное хранилище)
- Преимущества провайдера
- Контактная информация
- Футер с быстрыми ссылками

### 2. Форма подачи заявок

**Файл:** `src/app/request/page.tsx`

**Функции:**
- Сбор данных потенциального клиента
- Выбор желаемых услуг
- Валидация формы
- Отправка заявки в API
- Уведомление об успешной отправке

**Поля формы:**
- Имя и фамилия
- Номер телефона
- Адрес подключения
- Выбор услуг (чекбоксы)

**Валидация:**
- Проверка обязательных полей
- Валидация номера телефона по регулярному выражению
- Проверка выбора хотя бы одной услуги

### 3. Система авторизации

**Файлы:** 
- `src/app/auth/page.tsx` - страница авторизации
- `src/shared/hooks/useAuth.ts` - хук управления аутентификацией
- `src/shared/providers/AuthProvider.tsx` - провайдер контекста

**Функции:**
- Двухэтапная авторизация по номеру телефона
- Отправка SMS с кодом подтверждения
- Проверка кода и получение JWT токена
- Сохранение сессии в localStorage
- Автоматическая проверка валидности токена

**Процесс авторизации:**
1. Ввод номера телефона
2. Отправка SMS с 4-значным кодом
3. Ввод кода подтверждения
4. Получение токена и данных клиента
5. Перенаправление в личный кабинет

### 4. Личный кабинет абонента

**Файлы:**
- `src/app/cabinet/page.tsx` - главная страница кабинета
- `src/app/cabinet/components/AccountSelector.tsx` - выбор лицевого счета
- `src/app/cabinet/components/AccountInfo.tsx` - информация о счете
- `src/app/cabinet/components/PaymentHistory.tsx` - история платежей

**Функции:**
- Отображение информации о клиенте
- Управление несколькими лицевыми счетами
- Просмотр баланса и тарифа
- История платежей с пагинацией
- Быстрый переход к оплате

**Информация о счете:**
- Текущий баланс
- Активный тариф и скорость
- Статус подключения
- Подключенные услуги
- Прогресс до блокировки
- Количество дней до списания

### 5. Система оплаты

**Файлы:**
- `src/app/payment/page.tsx` - страница оплаты
- `src/app/payment/result/page.tsx` - результат оплаты

**Функции:**
- Поиск лицевого счета по телефону/адресу
- Выбор суммы пополнения
- Интеграция с Robokassa
- Обработка результата платежа
- Уведомления о статусе оплаты

**Способы поиска счета:**
- По номеру телефона
- По адресу
- По номеру лицевого счета

**Функции оплаты:**
- Быстрый выбор суммы (предустановленные значения)
- Ручной ввод суммы
- Валидация минимальной/максимальной суммы
- Перенаправление на платежный шлюз
- Обработка успешных и неуспешных платежей

## Конфигурация

### Основная конфигурация

**Файл:** `src/shared/config/config.ts`

```typescript
export const config = {
  api: {
    baseUrl: process.env.NEXT_PUBLIC_API_URL_WEB || 'http://localhost:3001/api',
    timeout: 10000,
  },
  app: {
    name: 'OK-Telecom',
    description: 'Интернет-провайдер OK-Telecom',
    port: 3003,
  },
  auth: {
    sessionTimeout: 30 * 60 * 1000, // 30 минут
    phoneVerificationTimeout: 5 * 60 * 1000, // 5 минут
  },
  payment: {
    robokassa: {
      merchantId: process.env.NEXT_PUBLIC_ROBOKASSA_MERCHANT_ID || '',
      testMode: process.env.NODE_ENV !== 'production',
    },
  },
  ui: {
    itemsPerPage: 10,
    debounceDelay: 300,
  },
  validation: {
    phoneRegex: /^(\+7|8)?[\s\-]?\(?[489][0-9]{2}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/,
    minPasswordLength: 6,
  },
} as const;
```

### Переменные окружения

```bash
# API настройки для app-web (публичный сайт)
NEXT_PUBLIC_API_URL_WEB=http://localhost:3001/api

# Robokassa настройки
NEXT_PUBLIC_ROBOKASSA_MERCHANT_ID=your_merchant_id

# Yandex Maps (если используется)
NEXT_PUBLIC_YANDEX_MAPS_API_KEY=your_yandex_maps_api_key
```

## API интеграция

### API клиент

**Файл:** `src/shared/api/index.ts`

Реализован типизированный HTTP клиент с поддержкой:
- Автоматических таймаутов
- Обработки ошибок
- Типизированных ответов
- Настраиваемых заголовков

### Основные API endpoints

```typescript
// Авторизация
POST /auth/request-code - отправка SMS кода
POST /auth/verify-code - проверка кода
GET /auth/verify - проверка токена

// Заявки
POST /requests - создание заявки

// Лицевые счета
GET /accounts/search - поиск счетов
GET /accounts/:id - информация о счете
GET /accounts/:id/payments - история платежей

// Платежи
POST /payments/create - создание платежа
POST /payments/verify - проверка результата
```

## Типы данных

**Файл:** `src/shared/types/index.ts`

Определены TypeScript интерфейсы для всех сущностей:
- Client - данные клиента
- Account - лицевой счет
- Tariff - тарифный план
- Service - услуга
- Payment - платеж
- Request - заявка

## Компоненты

### Защищенные маршруты

**Файл:** `src/shared/components/ProtectedRoute.tsx`

Компонент для защиты страниц, требующих авторизации:
- Проверка статуса аутентификации
- Автоматическое перенаправление на страницу входа
- Отображение загрузки во время проверки

### Селектор лицевых счетов

**Файл:** `src/app/cabinet/components/AccountSelector.tsx`

Компонент для выбора активного лицевого счета:
- Отображается только при наличии нескольких счетов
- Показывает основную информацию о каждом счете
- Цветовая индикация статуса

### Информация о счете

**Файл:** `src/app/cabinet/components/AccountInfo.tsx`

Детальная информация о выбранном лицевом счете:
- Текущий баланс и статус
- Информация о тарифе и скорости
- Подключенные услуги
- Предупреждения о низком балансе
- Прогресс-бар до блокировки

### История платежей

**Файл:** `src/app/cabinet/components/PaymentHistory.tsx`

Таблица с историей операций по счету:
- Пагинация результатов
- Фильтрация по источнику платежа
- Цветовая индикация статусов
- Форматирование дат и сумм

## Стилизация

### Material-UI тема

**Файл:** `src/shared/config/mui.theme.ts`

Настроенная тема с:
- Корпоративными цветами
- Кастомными компонентами
- Адаптивной типографикой
- Скругленными углами для карточек

### Адаптивный дизайн

Все компоненты адаптированы для:
- Мобильных устройств (xs, sm)
- Планшетов (md)
- Десктопов (lg, xl)

## Безопасность

### Аутентификация

- JWT токены с автоматическим обновлением
- Проверка валидности токенов
- Безопасное хранение в localStorage
- Автоматический logout при истечении сессии

### Валидация данных

- Клиентская валидация форм
- Санитизация пользовательского ввода
- Проверка номеров телефонов по регулярным выражениям
- Ограничения на суммы платежей

## Производительность

### Оптимизации

- Lazy loading компонентов
- Мемоизация тяжелых вычислений
- Дебаунс для поисковых запросов
- Пагинация больших списков

### Кеширование

- Кеширование данных клиента в контексте
- Сохранение состояния в localStorage
- Оптимистичные обновления UI

## Развертывание

### Сборка

```bash
cd packages/app-web
yarn build
yarn start
```

### Docker

Приложение готово для контейнеризации с Next.js standalone режимом.

### Переменные окружения

Все чувствительные данные вынесены в переменные окружения согласно правилам проекта.

## Дальнейшее развитие

### Планируемые улучшения

1. **PWA поддержка** - превращение в Progressive Web App
2. **Push уведомления** - уведомления о платежах и балансе
3. **Геолокация** - интеграция с Yandex Maps для адресов
4. **Чат поддержка** - встроенный чат с техподдержкой
5. **Темная тема** - переключение между светлой и темной темами

### Интеграции

1. **Telegram Web App** - интеграция с Telegram Mini Apps
2. **Социальные сети** - авторизация через соцсети
3. **Платежные системы** - добавление других платежных шлюзов
4. **Аналитика** - интеграция с Google Analytics или Yandex Metrica

## Тестирование

### Рекомендуемые тесты

1. **Unit тесты** - для утилит и хуков
2. **Integration тесты** - для API интеграции
3. **E2E тесты** - для пользовательских сценариев
4. **Accessibility тесты** - для доступности

### Инструменты

- Jest для unit тестов
- React Testing Library для компонентов
- Playwright для E2E тестов
- Axe для accessibility тестов
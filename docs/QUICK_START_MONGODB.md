# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å MongoDB

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Å MongoDB —Ä–µ–ø–ª–∏–∫–æ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```cmd
start-with-mongodb.cmd
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –°–æ–∑–¥–∞—Å—Ç .env.development –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
2. üîë –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª—é—á –¥–ª—è MongoDB —Ä–µ–ø–ª–∏–∫–∏
3. üê≥ –ó–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (MongoDB, Zabbix, Grafana, nginx)
4. ‚è≥ –î–æ–∂–¥–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ MongoDB —Ä–µ–ø–ª–∏–∫–∏
5. üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å —Ä–µ–ø–ª–∏–∫–∏
6. üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π app-server –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –æ–∫–Ω–µ

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```cmd
# –ö–æ–ø–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
copy .env.development.example .env.development

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á MongoDB
openssl rand -base64 756 > mongodb-keyfile
```

### 2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```cmd
docker-compose -f docker-compose.dev.yml --env-file .env.development up -d
```

### 3. –ó–∞–ø—É—Å–∫ app-server –ª–æ–∫–∞–ª—å–Ω–æ
```cmd
cd packages/app-server
yarn dev
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ MongoDB
```cmd
# –ñ–¥–µ–º 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
timeout /t 30

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä–µ–ø–ª–∏–∫–∏
docker exec mongodb-primary-dev mongosh --eval "rs.status()" --quiet
```

## –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:

| –°–µ—Ä–≤–∏—Å | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----|----------|
| **App Web** | http://localhost/ | –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| **App Server API** | http://localhost/api/health | REST API —Å–µ—Ä–≤–µ—Ä |
| **App Web Billing** | http://localhost/billing | –ë–∏–ª–ª–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞ |
| **Zabbix** | http://localhost/zabbix/ | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Admin/zabbix) |
| **Grafana** | http://localhost/grafana/ | –î–∞—à–±–æ—Ä–¥—ã (admin/admin) |
| **MongoDB Primary** | localhost:27017 | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î |
| **MongoDB Secondary** | localhost:27018 | –í—Ç–æ—Ä–∏—á–Ω–∞—è –ë–î |
| **MongoDB Arbiter** | localhost:27019 | –ê—Ä–±–∏—Ç—Ä |

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB

### –ß–µ—Ä–µ–∑ app-server –ª–æ–≥–∏
```cmd
docker logs app-server-dev
```

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
```
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB —Ä–µ–ø–ª–∏–∫–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: app_database
üîó –†–µ–ø–ª–∏–∫–∞ —Å–µ—Ç: rs0
üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3001
```

### –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
```cmd
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ primary —É–∑–ª—É
docker exec -it mongodb-primary-dev mongosh -u admin -p mongodb_admin_pwd

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–ø–ª–∏–∫–∏
rs.status()

# –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
show dbs

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –±–∞–∑—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
use app_database

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–π
show collections
```

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```cmd
docker-compose -f docker-compose.dev.yml down
```

–î–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ (–≤–∫–ª—é—á–∞—è volumes):
```cmd
docker-compose -f docker-compose.dev.yml down -v
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### MongoDB —Ä–µ–ø–ª–∏–∫–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
```cmd
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
docker logs mongodb-setup-dev

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
docker-compose -f docker-compose.dev.yml restart mongodb-setup
```

### App Server –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î
```cmd
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ app-server
docker logs app-server-dev

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker exec app-server-dev env | grep DATABASE_URL
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–∞–º–∏
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã 27017-27019 –∏ 3001 —Å–≤–æ–±–æ–¥–Ω—ã:
```cmd
netstat -an | findstr "27017\|27018\|27019\|3001"
```
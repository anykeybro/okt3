# Kafka –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è MikroTik

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Apache Kafka –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è MikroTik —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Å–µ—Ç–µ–≤—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TB
    subgraph "–ë–∏–ª–ª–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞"
        API[API Server]
        PRODUCER[Kafka Producer]
        CONSUMER[Kafka Consumer]
        MONITOR[Command Monitor]
    end
    
    subgraph "Kafka Cluster"
        TOPIC1[mikrotik-commands]
        TOPIC2[device-status]
        TOPIC3[notifications]
    end
    
    subgraph "MikroTik —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"
        MT1[MikroTik Router 1]
        MT2[MikroTik Router 2]
        MT3[MikroTik Router N]
    end
    
    API --> PRODUCER
    PRODUCER --> TOPIC1
    TOPIC1 --> CONSUMER
    CONSUMER --> MT1
    CONSUMER --> MT2
    CONSUMER --> MT3
    
    CONSUMER --> TOPIC2
    TOPIC2 --> MONITOR
    MONITOR --> TOPIC3
```

## –¢–æ–ø–∏–∫–∏ Kafka

### 1. mikrotik-commands
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ MikroTik —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**:
```typescript
interface MikroTikCommand {
  type: 'ADD_DHCP' | 'REMOVE_DHCP' | 'BLOCK_CLIENT' | 'UNBLOCK_CLIENT' | 'GET_STATS';
  deviceId: string;
  accountId: string;
  macAddress: string;
  ipAddress?: string;
  poolName?: string;
  timestamp: number;
}
```

**–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥**:
```json
{
  "type": "ADD_DHCP",
  "deviceId": "device-123",
  "accountId": "account-456",
  "macAddress": "00:11:22:33:44:55",
  "ipAddress": "192.168.1.100",
  "poolName": "dhcp-pool",
  "timestamp": 1703123456789
}
```

### 2. device-status
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**:
```typescript
interface MikroTikCommandResult {
  commandId: string;
  deviceId: string;
  success: boolean;
  result?: any;
  error?: string;
  timestamp: number;
}
```

### 3. notifications
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. MikroTikKafkaConsumer

**–§–∞–π–ª**: `packages/app-server/src/modules/devices/kafka.consumer.ts`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫ `mikrotik-commands`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ MikroTik
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ç–æ–ø–∏–∫ `device-status`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CommandMonitorService

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã**:

#### ADD_DHCP
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ DHCP lease –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
```typescript
{
  type: 'ADD_DHCP',
  deviceId: 'device-id',
  accountId: 'account-id',
  macAddress: '00:11:22:33:44:55',
  ipAddress: '192.168.1.100',
  poolName: 'dhcp-pool'
}
```

#### REMOVE_DHCP
–£–¥–∞–ª–µ–Ω–∏–µ DHCP lease –∫–ª–∏–µ–Ω—Ç–∞
```typescript
{
  type: 'REMOVE_DHCP',
  deviceId: 'device-id',
  accountId: 'account-id',
  macAddress: '00:11:22:33:44:55'
}
```

#### BLOCK_CLIENT
–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤)
```typescript
{
  type: 'BLOCK_CLIENT',
  deviceId: 'device-id',
  accountId: 'account-id',
  macAddress: '00:11:22:33:44:55'
}
```

#### UNBLOCK_CLIENT
–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
```typescript
{
  type: 'UNBLOCK_CLIENT',
  deviceId: 'device-id',
  accountId: 'account-id',
  macAddress: '00:11:22:33:44:55'
}
```

#### GET_STATS
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞
```typescript
{
  type: 'GET_STATS',
  deviceId: 'device-id',
  accountId: 'account-id',
  macAddress: '00:11:22:33:44:55'
}
```

### 2. CommandMonitorService

**–§–∞–π–ª**: `packages/app-server/src/modules/devices/command-monitor.service.ts`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–°—Ç–∞—Ç—É—Å—ã –∫–æ–º–∞–Ω–¥**:
- `pending` - –ö–æ–º–∞–Ω–¥–∞ –æ–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `processing` - –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- `completed` - –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- `failed` - –ö–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π
- `timeout` - –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è

### 3. MikroTikService

**–§–∞–π–ª**: `packages/app-server/src/modules/devices/mikrotik.service.ts`

**–§—É–Ω–∫—Ü–∏–∏**:
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å MikroTik API
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–ú–µ—Ç–æ–¥—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**:
1. **Address List** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ IP –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
2. **Firewall Filter** - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ MAC

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã
```http
POST /api/devices/commands
Content-Type: application/json

{
  "deviceId": "device-123",
  "accountId": "account-456",
  "type": "BLOCK_CLIENT",
  "macAddress": "00:11:22:33:44:55"
}
```

### –°—Ç–∞—Ç—É—Å –∫–æ–º–∞–Ω–¥—ã
```http
GET /api/devices/commands/{commandId}
```

### –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```http
GET /api/devices/commands/active
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥
```http
GET /api/devices/commands/stats
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# Kafka –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
KAFKA_BROKERS=localhost:29092
KAFKA_CLIENT_ID=app-server-dev
KAFKA_GROUP_ID=app-server-group-dev

# MikroTik –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
MIKROTIK_DEFAULT_PORT=8728
MIKROTIK_DEFAULT_TIMEOUT=10000
MIKROTIK_HEALTH_CHECK_INTERVAL=300000
MIKROTIK_MAX_RETRIES=3
MIKROTIK_RETRY_DELAY=5000
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –∫–æ–¥–µ
```typescript
// packages/app-server/src/config/config.ts
kafka: {
  brokers: process.env.KAFKA_BROKERS?.split(',') || ['localhost:29092'],
  clientId: process.env.KAFKA_CLIENT_ID || 'app-server',
  groupId: process.env.KAFKA_GROUP_ID || 'billing-group',
  topics: {
    mikrotikCommands: 'mikrotik-commands',
    deviceStatus: 'device-status',
    notifications: 'notifications',
  },
},

mikrotik: {
  defaultPort: parseInt(process.env.MIKROTIK_DEFAULT_PORT || '8728', 10),
  defaultTimeout: parseInt(process.env.MIKROTIK_DEFAULT_TIMEOUT || '10000', 10),
  healthCheckInterval: parseInt(process.env.MIKROTIK_HEALTH_CHECK_INTERVAL || '300000', 10),
  maxRetries: parseInt(process.env.MIKROTIK_MAX_RETRIES || '3', 10),
  retryDelay: parseInt(process.env.MIKROTIK_RETRY_DELAY || '5000', 10),
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —ç–º–æ–¥–∑–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞:
- üéØ –ó–∞–ø—É—Å–∫ consumer'–∞
- üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- ‚ùå –û—à–∏–±–∫–∏
- üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- üì• –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- üîÑ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- ‚è∞ –¢–∞–π–º–∞—É—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –°—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫
1. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏** - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
2. **–û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** - –ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. **–û—à–∏–±–∫–∏ API** - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥—ã
4. **–¢–∞–π–º–∞—É—Ç—ã** - –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã** - –î–æ 3 –ø–æ–ø—ã—Ç–æ–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
2. **Graceful degradation** - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Kafka
3. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã** - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã
```bash
cd packages/app-server
yarn test src/modules/devices/__tests__/kafka-integration.test.ts
```

### Integration —Ç–µ—Å—Ç—ã
–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- –û—Ç–ø—Ä–∞–≤–∫—É –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π Kafka
- –û–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–º–∞–Ω–¥
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–º–∞–Ω–¥
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Docker
```bash
# –ó–∞–ø—É—Å–∫ Kafka –≤ Docker
docker-compose up -d kafka

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
yarn test:integration
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
1. **Batch processing** - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
2. **Connection pooling** - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
3. **Async processing** - –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
4. **Caching** - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ consumer'–æ–≤
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
- Load balancing –º–µ–∂–¥—É —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
- –ê—É–¥–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∫–æ–º–∞–Ω–¥ –ø–æ —Ä–æ–ª—è–º

## Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### Kafka –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Kafka
docker-compose ps kafka

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs kafka
```

#### –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
ping 192.168.1.1

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl -X GET http://192.168.1.1/rest/system/identity
```

#### –ö–æ–º–∞–Ω–¥—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Kafka consumer'–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
curl http://localhost:3001/health

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥
curl http://localhost:3001/api/devices/commands/stats

# –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
curl http://localhost:3001/api/devices/commands/active
```

## –†–∞–∑–≤–∏—Ç–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **Batch –æ–ø–µ—Ä–∞—Ü–∏–∏** - –ì—Ä—É–ø–ø–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
2. **Priority queues** - –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
3. **Dead letter queues** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
4. **Metrics collection** - –°–±–æ—Ä –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
5. **Real-time monitoring** - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- Zabbix –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- Grafana –¥–∞—à–±–æ—Ä–¥—ã
- Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Email –∞–ª–µ—Ä—Ç—ã
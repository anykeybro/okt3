// –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è MongoDB —Ä–µ–ø–ª–∏–∫–∏ –¥–ª—è localhost
// –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

print('üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ MongoDB —Ä–µ–ø–ª–∏–∫–∏ –¥–ª—è localhost...');

try {
  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  var currentConfig = rs.conf();
  print('üìù –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:');
  printjson(currentConfig);

  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å localhost —Ö–æ—Å—Ç–∞–º–∏
  var newConfig = {
    _id: "rs0",
    version: currentConfig.version + 1,
    members: [
      { _id: 0, host: "localhost:27017", priority: 2 },
      { _id: 1, host: "localhost:27018", priority: 1 },
      { _id: 2, host: "localhost:27019", arbiterOnly: true }
    ]
  };

  print('üìù –ù–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:');
  printjson(newConfig);

  // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  var result = rs.reconfig(newConfig, {force: true});
  print('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:');
  printjson(result);

  // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  print('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
  sleep(15000);

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
  var status = rs.status();
  print('üìä –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å —Ä–µ–ø–ª–∏–∫–∏:');
  printjson(status);

  print('üéâ –†–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MongoDB —Ä–µ–ø–ª–∏–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');

} catch (error) {
  print('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–µ–ø–ª–∏–∫–∏:', error);
  quit(1);
}